## About the connector
Microsoft Defender for IoT consolidates real-time asset discovery, vulnerability management, and cyberthreat protection for your Internet of Things (IoT) and industrial infrastructure, such as industrial control systems (ICS) and operational technology (OT). This connector facilitates automated interactions, with a Microsoft Defender for IoT server using FortiSOARâ„¢ playbooks to effectively view, analyze, and respond to alerts generated by Defender for IoT 
<p>This document provides information about the Microsoft Defender for IoT Connector, which facilitates automated interactions, with a Microsoft Defender for IoT server using FortiSOAR&trade; playbooks. Add the Microsoft Defender for IoT Connector as a step in FortiSOAR&trade; playbooks and perform automated operations with Microsoft Defender for IoT.</p>

### Version information

Connector Version: 1.0.0


Authored By: Fortinet

Certified: No
## Installing the connector
<p>Use the <strong>Content Hub</strong> to install the connector. For the detailed procedure to install a connector, click <a href="https://docs.fortinet.com/document/fortisoar/0.0.0/installing-a-connector/1/installing-a-connector" target="_top">here</a>.</p><p>You can also use the <code>yum</code> command as a root user to install the connector:</p>
<pre>yum install cyops-connector-microsoft-defender-for-iot</pre>

## Prerequisites to configuring the connector
- You must have the credentials of Microsoft Defender for IoT server to which you will connect and perform automated operations.
- The FortiSOAR&trade; server should have outbound connectivity to port 443 on the Microsoft Defender for IoT server.

## Minimum Permissions Required
- Not applicable

## Configuring the connector
For the procedure to configure a connector, click [here](https://docs.fortinet.com/document/fortisoar/0.0.0/configuring-a-connector/1/configuring-a-connector)
### Configuration parameters
<p>In FortiSOAR&trade;, on the Connectors page, click the <strong>Microsoft Defender for IoT</strong> connector row (if you are in the <strong>Grid</strong> view on the Connectors page) and in the <strong>Configurations</strong> tab enter the required configuration details:</p>
<table border=1><thead><tr><th>Parameter</th><th>Description</th></tr></thead><tbody><tr><td>Server URL</td><td>IP address or hostname of the Microsoft Defender for IoT server to which you will connect and perform automated operations.
</td>
</tr><tr><td>Access Token</td><td>Specify the access token for authentication with Microsoft Defender for IoT.
</td>
</tr><tr><td>Verify SSL</td><td>Specifies whether the SSL certificate for the server is to be verified or not. <br/>By default, this option is set to True.</td></tr>
</tbody></table>

## Actions supported by the connector
The following automated operations can be included in playbooks and you can also use the annotations to access operations:
<table border=1><thead><tr><th>Function</th><th>Description</th><th>Annotation and Category</th></tr></thead><tbody><tr><td>Get Alert List</td><td>Retrieves a list of alerts that Defender for IoT sensor has detected based on input parameters specified.</td><td>list_alerts <br/>Investigation</td></tr>
<tr><td>Get Timeline Events</td><td>Retrieves a list of events reported to the event timeline.</td><td>list_timeline_events <br/>Investigation</td></tr>
<tr><td>Get Device List</td><td>Retrieves a list of devices detected by this sensor based on input parameter specified.</td><td>list_devices <br/>Investigation</td></tr>
<tr><td>Get Device CVEs List</td><td>Retrieves a list of all known CVEs discovered on devices in the network, sorted by descending CVE score.</td><td>list_device_cves <br/>Investigation</td></tr>
<tr><td>Get Device Vulnerability Information</td><td>Retrieves  a general vulnerability assessment report. This assessment provides insight into your system's security level.</td><td>get_device_vulnerability_report <br/>Investigation</td></tr>
<tr><td>Get Security Vulnerabilities</td><td>Retrieves general vulnerability assessment report. This assessment provides insight into your system's security level.</td><td>get_vulnerability_assessment_report <br/>Investigation</td></tr>
<tr><td>Get Operational Vulnerabilities</td><td>Retrieves operational vulnerability assessment report. This assessment provides insight into the operational status of your network. It's based on general network and system information and not on a specific device evaluation.</td><td>get_operational_assessment_report <br/>Investigation</td></tr>
<tr><td>Get Mitigation Steps</td><td>Retrieves a mitigation assessment. This assessment provides recommended steps for mitigating detected vulnerabilities. It's based on general network and system information and not on a specific device evaluation.</td><td>get_mitigation_assessment <br/>Investigation</td></tr>
</tbody></table>

### operation: Get Alert List
#### Input parameters
<table border=1><thead><tr><th>Parameter</th><th>Description</th></tr></thead><tbody><tr><td>State</td><td>(Optional) Select the state of alerts to be retrieved from Defender for IoT. You can choose from Handled or Unhandled.
</td></tr><tr><td>Type</td><td>(Optional) Select the type of alerts to be retrieved from Defender for IoT. You can choose from Unexpected New Devices, Disconnections.
</td></tr><tr><td>Created After</td><td>(Optional) Specify the date and time to retrieve alerts created after the specified time from Defender for IoT.
</td></tr><tr><td>Created Before</td><td>(Optional) Specify a datetime to retrieve alerts created before the specified time from Defender for IoT.
</td></tr></tbody></table>

#### Output
The output contains the following populated JSON schema:

<pre>[
    {
        "engine": "",
        "severity": "",
        "title": "",
        "additionalinformation": {
            "information": [],
            "description": ""
        },
        "sourceDevice": "",
        "destinationDevice": "",
        "time": "",
        "message": "",
        "id": ""
    }
]</pre>
### operation: Get Timeline Events
#### Input parameters
<table border=1><thead><tr><th>Parameter</th><th>Description</th></tr></thead><tbody><tr><td>Type</td><td>(Optional) Select the type of alerts to be retrieved from Defender for IoT.<br/>
You can choose from following:<br/>
<li>Address Update</li>
<li>Alert Detected</li>
<li>Alert Updated</li>
<li>Back to Normal</li>
<li>Cleartext Authentication</li>
<li>Common ASCII Message Protocol Memory Write Operation</li>
<li>Configuration Of Cleartext Password</li>
<li>Controller Program Delete</li>
<li>Controller Program Reset</li>
<li>Controller Reset</li>
<li>Controller Start</li>
<li>Controller Stop</li>
<li>Data Intelligence Package Installation Failure</li>
<li>Data Intelligence Package Uploaded</li>
<li>Database Structure Manipulation</li>
<li>DeltaV Install Script</li>
<li>Device Connection Detected</li>
<li>Device Deleted</li>
<li>Device Detected</li>
<li>Device Updated</li>
<li>Event Detected and Muted</li>
<li>Exclusion Rule Created</li>
<li>Exclusion Rule Removed</li>
<li>Exclusion Rule Updated</li>
<li>FTP Authentication Failure</li>
<li>File Transfer Detected</li>
<li>Firmware Update</li>
<li>HTTP Basic Authentication</li>
<li>Inactive Devices Scheduled for deletion</li>
<li>Internet Access</li>
<li>MMS Memory Block Operation</li>
<li>MMS Program Operation</li>
<li>Notification was resolved manually</li>
<li>OPC AE Event</li>
<li>OPC AE Event Condition Management Operation</li>
<li>OPC AE Event Subscription</li>
<li>OPC Data Access Group Management Operation</li>
<li>OPC Data Access IO Subscription Management Operation</li>
<li>OPC Data Access Item Management Operation</li>
<li>PLC Change access level</li>
<li>PLC Change access level failed</li>
<li>PLC Configuration Read</li>
<li>PLC Configuration Write</li>
<li>PLC Firmware Changed</li>
<li>PLC Mode Change</li>
<li>PLC Module Change</li>
<li>PLC Operating Mode Change Detected</li>
<li>PLC Password Change</li>
<li>PLC Program Update</li>
<li>PLC Program Upload</li>
<li>PLC Programming</li>
<li>PLC Programming Mode Set</li>
<li>PLC Reset</li>
<li>PLC Start</li>
<li>Profinet SET operation</li>
<li>Remote Access Connection Established</li>
<li>Remote Process Execution</li>
<li>Report Created</li>
<li>SCL Uploaded</li>
<li>SNMP Trap detected</li>
<li>Scan Device Detected</li>
<li>Siemens S7 Authentication</li>
<li>Siemens S7 Memory Block Operation</li>
<li>Syslog Message</li>
<li>Telnet Authentication Failure</li>
<li>User Defined Event</li>
<li>User Defined Rule Created</li>
<li>User Defined Rule Deleted</li>
<li>User Defined Rule Edited</li>
<li>User Defined Rule Operation</li>
<li>User Login Attempt</li>
<li>User Operation</li>
<li>Wonderware session initialized</li>
</td></tr><tr><td>Reported in Last x Minutes</td><td>(Optional) Specify the time duration (in minutes) to retrieve events reported within a given timeframe, calculated backward from the current time.
</td></tr></tbody></table>

#### Output
The output contains the following populated JSON schema:

<pre>[
    {
        "severity": "",
        "title": "",
        "timestamp": "",
        "content": "",
        "owner": "",
        "type": ""
    }
]</pre>
### operation: Get Device List
#### Input parameters
<table border=1><thead><tr><th>Parameter</th><th>Description</th></tr></thead><tbody><tr><td>Authorized</td><td>(Optional) Specify whether you want to retrieve authorized or unauthorized devices detected by this sensor. You can choose from True or False.
</td></tr></tbody></table>

#### Output

 The output contains a non-dictionary value.
### operation: Get Device CVEs List
#### Input parameters
<table border=1><thead><tr><th>Parameter</th><th>Description</th></tr></thead><tbody><tr><td>IP Address</td><td>(Optional) Specify the IP address to get CVEs for that device's IP address from Defender for IoT.
</td></tr><tr><td>Size</td><td>(Optional) Specify the number of top-scored CVEs to get for each device IP address from Defender for IoT. By default, it is set to 100.
</td></tr></tbody></table>

#### Output
The output contains the following populated JSON schema:

<pre>[
    {
        "cveId": "",
        "score": "",
        "ipAddress": "",
        "attackVector": "",
        "description": ""
    }
]</pre>
### operation: Get Device Vulnerability Information
#### Input parameters
None.
#### Output
The output contains the following populated JSON schema:

<pre>[
    {
        "name": "",
        "ipAddresses": [],
        "securityScore": "",
        "vendor": "",
        "firmwareVersion": "",
        "model": "",
        "operatingSystem": {
            "name": "",
            "type": "",
            "version": "",
            "latestVersion": ""
        },
        "vulnerabilities": {
            "antiViruses": [],
            "plainTextPasswords": [
                {
                    "password": "",
                    "protocol": "",
                    "strength": ""
                }
            ],
            "remoteAccess": [
                {
                    "port": "",
                    "transport": "",
                    "clientSoftware": "",
                    "client": ""
                }
            ],
            "isBackupServer": "",
            "openedPorts": [
                {
                    "port": "",
                    "transport": "",
                    "protocol": "",
                    "isConflictingWithFirewall": ""
                }
            ],
            "isEngineeringStation": "",
            "isKnownScanner": "",
            "cves": [
                {
                    "id": "",
                    "score": "",
                    "description": ""
                }
            ],
            "isUnauthorized": "",
            "malwareIndicationsDetected": ""
        }
    }
]</pre>
### operation: Get Security Vulnerabilities
#### Input parameters
None.
#### Output
The output contains the following populated JSON schema:

<pre>{
    "unauthorizedDevices": [
        {
            "address": "",
            "name": "",
            "firstDetectionTime": "",
            "lastSeen": ""
        }
    ],
    "redundantFirewallRules": [
        {
            "sources": "",
            "destinations": "",
            "ports": ""
        }
    ],
    "connectionsBetweenSubnets": [
        {
            "server": "",
            "client": ""
        }
    ],
    "industrialMalwareIndications": [
        {
            "detectionTime": "",
            "alertMessage": "",
            "description": "",
            "addresses": []
        }
    ],
    "illegalTrafficByFirewallRules": [
        {
            "server": "",
            "port": "",
            "client": "",
            "transport": ""
        }
    ],
    "internetConnections": [
        {
            "internalAddress": "",
            "authorized": "",
            "externalAddresses": []
        }
    ],
    "accessPoints": [
        {
            "macAddress": "",
            "vendor": "",
            "ipAddress": "",
            "name": "",
            "wireless": ""
        }
    ],
    "weakFirewallRules": [
        {
            "sources": "",
            "destinations": "",
            "ports": ""
        }
    ]
}</pre>
### operation: Get Operational Vulnerabilities
#### Input parameters
None.
#### Output
The output contains the following populated JSON schema:

<pre>{
    "backupServer": [
        {
            "backupMaximalInterval": "",
            "source": "",
            "destination": "",
            "port": "",
            "transport": "",
            "lastSeenBackup": ""
        }
    ],
    "ipNetworks": [
        {
            "addresses": "",
            "network": "",
            "mask": ""
        }
    ],
    "protocolProblems": [
        {
            "protocol": "",
            "addresses": [],
            "alert": "",
            "reportTime": ""
        }
    ],
    "protocolDataVolumes": [
        {
            "protocol": "",
            "volume": ""
        }
    ],
    "disconnections": [
        {
            "assetAddress": "",
            "assetName": "",
            "lastDetectionTime": "",
            "backToNormalTime": ""
        }
    ]
}</pre>
### operation: Get Mitigation Steps
#### Input parameters
None.
#### Output
The output contains the following populated JSON schema:

<pre>{
    "notifications": [],
    "mitigation": [
        {
            "content": "",
            "details": "",
            "scoreImprovement": ""
        }
    ]
}</pre>
## Included playbooks
The `Sample - microsoft-defender-for-iot - 1.0.0` playbook collection comes bundled with the Microsoft Defender for IoT connector. These playbooks contain steps using which you can perform all supported actions. You can see bundled playbooks in the **Automation** > **Playbooks** section in FortiSOAR&trade; after importing the Microsoft Defender for IoT connector.

- Get Alert List
- Get Device CVEs List
- Get Device List
- Get Device Vulnerability Information
- Get Mitigation Steps
- Get Operational Vulnerabilities
- Get Security Vulnerabilities
- Get Timeline Events

**Note**: If you are planning to use any of the sample playbooks in your environment, ensure that you clone those playbooks and move them to a different collection since the sample playbook collection gets deleted during connector upgrade and delete.
